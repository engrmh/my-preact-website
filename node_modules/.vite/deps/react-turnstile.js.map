{
  "version": 3,
  "sources": ["../../react-turnstile/src/index.tsx"],
  "sourcesContent": ["import React, { useEffect, useState, useRef } from \"react\";\nimport {\n  TurnstileObject,\n  TurnstileOptions,\n  SupportedLanguages,\n} from \"turnstile-types\";\n\nconst globalNamespace = (\n  typeof globalThis !== \"undefined\" ? globalThis : window\n) as any;\nlet turnstileState =\n  typeof globalNamespace.turnstile !== \"undefined\" ? \"ready\" : \"unloaded\";\nlet ensureTurnstile: () => Promise<any>;\n\n// Functions responsible for loading the turnstile api, while also making sure\n// to only load it once\nlet turnstileLoad: {\n  resolve: (value?: any) => void;\n  reject: (reason?: any) => void;\n};\nconst turnstileLoadPromise = new Promise((resolve, reject) => {\n  turnstileLoad = { resolve, reject };\n  if (turnstileState === \"ready\") resolve(undefined);\n});\n\n{\n  const TURNSTILE_LOAD_FUNCTION = \"cf__reactTurnstileOnLoad\";\n  const TURNSTILE_SRC = \"https://challenges.cloudflare.com/turnstile/v0/api.js\";\n\n  ensureTurnstile = () => {\n    if (turnstileState === \"unloaded\") {\n      turnstileState = \"loading\";\n      globalNamespace[TURNSTILE_LOAD_FUNCTION] = () => {\n        turnstileLoad.resolve();\n        turnstileState = \"ready\";\n        delete globalNamespace[TURNSTILE_LOAD_FUNCTION];\n      };\n      const url = `${TURNSTILE_SRC}?onload=${TURNSTILE_LOAD_FUNCTION}&render=explicit`;\n      const script = document.createElement(\"script\");\n      script.src = url;\n      script.async = true;\n      script.addEventListener(\"error\", () => {\n        turnstileLoad.reject(\"Failed to load Turnstile.\");\n        delete globalNamespace[TURNSTILE_LOAD_FUNCTION];\n      });\n      document.head.appendChild(script);\n    }\n    return turnstileLoadPromise;\n  };\n}\n\nexport default function Turnstile({\n  id,\n  className,\n  style,\n  sitekey,\n  action,\n  cData,\n  theme,\n  language,\n  tabIndex,\n  responseField,\n  responseFieldName,\n  size,\n  fixedSize,\n  retry,\n  retryInterval,\n  refreshExpired,\n  appearance,\n  execution,\n  userRef,\n  onVerify,\n  onLoad,\n  onError,\n  onExpire,\n  onTimeout,\n}: TurnstileProps) {\n  const ownRef = useRef<HTMLDivElement | null>(null);\n  const inplaceState = useState<TurnstileCallbacks>({ onVerify })[0];\n\n  const ref = userRef ?? ownRef;\n\n  useEffect(() => {\n    if (!ref.current) return;\n    let cancelled = false;\n    let widgetId = \"\",\n      timeoutId = 0;\n    (async () => {\n      // load turnstile\n      if (turnstileState !== \"ready\") {\n        try {\n          await ensureTurnstile();\n        } catch (e) {\n          inplaceState.onError?.(e);\n          return;\n        }\n      }\n      if (cancelled || !ref.current) return;\n      let boundTurnstileObject: BoundTurnstileObject;\n      const turnstileOptions: TurnstileOptions = {\n        sitekey,\n        action,\n        cData,\n        theme,\n        language,\n        tabindex: tabIndex,\n        \"response-field\": responseField,\n        \"response-field-name\": responseFieldName,\n        size,\n        retry: \"never\", // see error-callback for why\n        \"retry-interval\": retryInterval,\n        \"refresh-expired\": refreshExpired,\n        appearance,\n        execution,\n        callback: (token: string) =>\n          inplaceState.onVerify(token, boundTurnstileObject),\n        \"error-callback\": (error?: any) => {\n          // we handle retry ourselves because turnstile does not properly\n          // reset its timeout when calling turnstile.remove, logging the\n          // following in the console:\n          // > [Cloudflare Turnstile] Nothing to reset found for provided container.\n          // refs:\n          // - https://github.com/Le0Developer/react-turnstile/issues/14\n          // - https://discord.com/channels/595317990191398933/1025131875397812224/1122137855368646717\n          // TODO: remove when fixed\n          if (!retry || retry === \"auto\") {\n            timeoutId = setTimeout(() => {\n              boundTurnstileObject.reset();\n              timeoutId = 0;\n              // no need to do bounds checks, turnstile already does them for us\n              // even though we have retry=never\n            }, 2000 + (retryInterval ?? 8000));\n          }\n          inplaceState.onError?.(error, boundTurnstileObject);\n        },\n        \"expired-callback\": (token: string) =>\n          inplaceState.onExpire?.(token, boundTurnstileObject),\n        \"timeout-callback\": () =>\n          inplaceState.onTimeout?.(boundTurnstileObject),\n      };\n\n      widgetId = window.turnstile.render(ref.current, turnstileOptions);\n      boundTurnstileObject = createBoundTurnstileObject(widgetId);\n      inplaceState.onLoad?.(widgetId, boundTurnstileObject);\n    })();\n    return () => {\n      cancelled = true;\n      if (widgetId) window.turnstile.remove(widgetId);\n      if (timeoutId) clearTimeout(timeoutId);\n    };\n  }, [\n    sitekey,\n    action,\n    cData,\n    theme,\n    language,\n    tabIndex,\n    responseField,\n    responseFieldName,\n    size,\n    retry,\n    retryInterval,\n    refreshExpired,\n    appearance,\n    execution,\n  ]);\n  useEffect(() => {\n    inplaceState.onVerify = onVerify;\n    inplaceState.onLoad = onLoad;\n    inplaceState.onError = onError;\n    inplaceState.onExpire = onExpire;\n    inplaceState.onTimeout = onTimeout;\n  }, [onVerify, onLoad, onError, onExpire, onTimeout]);\n\n  return (\n    <div\n      ref={ref}\n      id={id}\n      className={className}\n      style={\n        fixedSize\n          ? {\n              ...(style ?? {}),\n              width: size === \"compact\" ? \"130px\" : \"300px\",\n              height: size === \"compact\" ? \"120px\" : \"65px\",\n            }\n          : style\n      }\n    />\n  );\n}\n\nexport interface TurnstileProps extends TurnstileCallbacks {\n  sitekey: string;\n  action?: string;\n  cData?: string;\n  theme?: \"light\" | \"dark\" | \"auto\";\n  language?: SupportedLanguages | \"auto\";\n  tabIndex?: number;\n  responseField?: boolean;\n  responseFieldName?: string;\n  size?: \"normal\" | \"invisible\" | \"compact\";\n  fixedSize?: boolean;\n  retry?: \"auto\" | \"never\";\n  retryInterval?: number;\n  refreshExpired?: \"auto\" | \"manual\" | \"never\";\n  appearance?: \"always\" | \"execute\" | \"interaction-only\";\n  execution?: \"render\" | \"execute\";\n  id?: string;\n  userRef?: React.MutableRefObject<HTMLDivElement>;\n  className?: string;\n  style?: React.CSSProperties;\n}\n\nexport interface TurnstileCallbacks {\n  onVerify: (token: string, boundTurnstile: BoundTurnstileObject) => void;\n  onLoad?: (widgetId: string, boundTurnstile: BoundTurnstileObject) => void;\n  onError?: (\n    error?: Error | any,\n    boundTurnstile?: BoundTurnstileObject\n  ) => void;\n  onExpire?: (token: string, boundTurnstile: BoundTurnstileObject) => void;\n  onTimeout?: (boundTurnstile: BoundTurnstileObject) => void;\n}\n\nexport interface BoundTurnstileObject {\n  execute: (options?: TurnstileOptions) => void;\n  reset: () => void;\n  getResponse: () => void;\n}\n\nfunction createBoundTurnstileObject(widgetId: string): BoundTurnstileObject {\n  return {\n    execute: (options) => window.turnstile.execute(widgetId, options),\n    reset: () => window.turnstile.reset(widgetId),\n    getResponse: () => window.turnstile.getResponse(widgetId),\n  };\n}\n\nexport function useTurnstile(): TurnstileObject {\n  // we are using state here to trigger a component re-render once turnstile\n  // loads, so the component using this hook gets the object once its loaded\n  const [_, setState] = useState(turnstileState);\n\n  useEffect(() => {\n    if (turnstileState === \"ready\") return;\n    turnstileLoadPromise.then(() => setState(turnstileState));\n  }, []);\n\n  return globalNamespace.turnstile;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,QAAA,UAAA,aAAA,2DAAA;AAOA,QAAM,kBACJ,OAAO,eAAe,cAAc,aAAa;AAEnD,QAAI,iBACF,OAAO,gBAAgB,cAAc,cAAc,UAAU;AAC/D,QAAI;AAIJ,QAAI;AAIJ,QAAM,uBAAuB,IAAI,QAAQ,CAAC,SAAS,WAAU;AAC3D,sBAAgB,EAAE,SAAS,OAAM;AACjC,UAAI,mBAAmB;AAAS,gBAAQ,MAAS;IACnD,CAAC;AAED;AACE,YAAM,0BAA0B;AAChC,YAAM,gBAAgB;AAEtB,wBAAkB,MAAK;AACrB,YAAI,mBAAmB,YAAY;AACjC,2BAAiB;AACjB,0BAAgB,uBAAuB,IAAI,MAAK;AAC9C,0BAAc,QAAO;AACrB,6BAAiB;AACjB,mBAAO,gBAAgB,uBAAuB;UAChD;AACA,gBAAM,MAAM,GAAG,aAAa,WAAW,uBAAuB;AAC9D,gBAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,iBAAO,MAAM;AACb,iBAAO,QAAQ;AACf,iBAAO,iBAAiB,SAAS,MAAK;AACpC,0BAAc,OAAO,2BAA2B;AAChD,mBAAO,gBAAgB,uBAAuB;UAChD,CAAC;AACD,mBAAS,KAAK,YAAY,MAAM;;AAElC,eAAO;MACT;;AAGF,aAAwB,UAAU,EAChC,IACA,WACA,OACA,SACA,QACA,OACA,OACA,UACA,UACA,eACA,mBACA,MACA,WACA,OACA,eACA,gBACA,YACA,WACA,SACA,UACA,QACA,SACA,UACA,UAAS,GACM;AACf,YAAM,UAAS,GAAA,QAAA,QAA8B,IAAI;AACjD,YAAM,gBAAe,GAAA,QAAA,UAA6B,EAAE,SAAQ,CAAE,EAAE,CAAC;AAEjE,YAAM,MAAM,YAAO,QAAP,YAAO,SAAP,UAAW;AAEvB,OAAA,GAAA,QAAA,WAAU,MAAK;AACb,YAAI,CAAC,IAAI;AAAS;AAClB,YAAI,YAAY;AAChB,YAAI,WAAW,IACb,YAAY;AACd,SAAC,YAAW;;AAEV,cAAI,mBAAmB,SAAS;AAC9B,gBAAI;AACF,oBAAM,gBAAe;qBACd,GAAG;AACV,eAAA,KAAA,aAAa,aAAO,QAAA,OAAA,SAAA,SAAA,GAAA,KAAA,cAAG,CAAC;AACxB;;;AAGJ,cAAI,aAAa,CAAC,IAAI;AAAS;AAC/B,cAAI;AACJ,gBAAM,mBAAqC;YACzC;YACA;YACA;YACA;YACA;YACA,UAAU;YACV,kBAAkB;YAClB,uBAAuB;YACvB;YACA,OAAO;YACP,kBAAkB;YAClB,mBAAmB;YACnB;YACA;YACA,UAAU,CAAC,UACT,aAAa,SAAS,OAAO,oBAAoB;YACnD,kBAAkB,CAAC,UAAe;;AAShC,kBAAI,CAAC,SAAS,UAAU,QAAQ;AAC9B,4BAAY,WAAW,MAAK;AAC1B,uCAAqB,MAAK;AAC1B,8BAAY;gBAGd,GAAG,OAAQ,kBAAa,QAAb,kBAAa,SAAb,gBAAiB,IAAK;;AAEnC,eAAAA,MAAA,aAAa,aAAO,QAAAA,QAAA,SAAA,SAAAA,IAAA,KAAA,cAAG,OAAO,oBAAoB;YACpD;YACA,oBAAoB,CAAC,UAAiB;AAAA,kBAAAA;AACpC,sBAAAA,MAAA,aAAa,cAAQ,QAAAA,QAAA,SAAA,SAAAA,IAAA,KAAA,cAAG,OAAO,oBAAoB;YAAC;YACtD,oBAAoB,MAAK;AAAA,kBAAAA;AACvB,sBAAAA,MAAA,aAAa,eAAS,QAAAA,QAAA,SAAA,SAAAA,IAAA,KAAA,cAAG,oBAAoB;YAAC;;AAGlD,qBAAW,OAAO,UAAU,OAAO,IAAI,SAAS,gBAAgB;AAChE,iCAAuB,2BAA2B,QAAQ;AAC1D,WAAA,KAAA,aAAa,YAAM,QAAA,OAAA,SAAA,SAAA,GAAA,KAAA,cAAG,UAAU,oBAAoB;QACtD,GAAE;AACF,eAAO,MAAK;AACV,sBAAY;AACZ,cAAI;AAAU,mBAAO,UAAU,OAAO,QAAQ;AAC9C,cAAI;AAAW,yBAAa,SAAS;QACvC;MACF,GAAG;QACD;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;OACD;AACD,OAAA,GAAA,QAAA,WAAU,MAAK;AACb,qBAAa,WAAW;AACxB,qBAAa,SAAS;AACtB,qBAAa,UAAU;AACvB,qBAAa,WAAW;AACxB,qBAAa,YAAY;MAC3B,GAAG,CAAC,UAAU,QAAQ,SAAS,UAAU,SAAS,CAAC;AAEnD,aACE,QAAA,QAAA,cAAA,OAAA,EACE,KACA,IACA,WACA,OACE,YACI;QACE,GAAI,UAAK,QAAL,UAAK,SAAL,QAAS,CAAA;QACb,OAAO,SAAS,YAAY,UAAU;QACtC,QAAQ,SAAS,YAAY,UAAU;UAEzC,MAAK,CAAA;IAIjB;AA3IA,YAAA,UAAA;AAoLA,aAAS,2BAA2B,UAAgB;AAClD,aAAO;QACL,SAAS,CAAC,YAAY,OAAO,UAAU,QAAQ,UAAU,OAAO;QAChE,OAAO,MAAM,OAAO,UAAU,MAAM,QAAQ;QAC5C,aAAa,MAAM,OAAO,UAAU,YAAY,QAAQ;;IAE5D;AAEA,aAAgB,eAAY;AAG1B,YAAM,CAAC,GAAG,QAAQ,KAAI,GAAA,QAAA,UAAS,cAAc;AAE7C,OAAA,GAAA,QAAA,WAAU,MAAK;AACb,YAAI,mBAAmB;AAAS;AAChC,6BAAqB,KAAK,MAAM,SAAS,cAAc,CAAC;MAC1D,GAAG,CAAA,CAAE;AAEL,aAAO,gBAAgB;IACzB;AAXA,YAAA,eAAA;;;",
  "names": ["_a"]
}
